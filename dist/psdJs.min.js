DataStream=function(e,t,n){this._byteOffset=t||0,e instanceof ArrayBuffer?this.buffer=e:typeof e=="object"?(this.dataView=e,t&&(this._byteOffset+=t)):this.buffer=new ArrayBuffer(e||0),this.position=0,this.endianness=n==null?DataStream.LITTLE_ENDIAN:n},DataStream.prototype={},DataStream.BIG_ENDIAN=!1,DataStream.LITTLE_ENDIAN=!0,DataStream.prototype._dynamicSize=!0,Object.defineProperty(DataStream.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),DataStream.prototype._byteLength=0,Object.defineProperty(DataStream.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(DataStream.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(DataStream.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),DataStream.prototype._realloc=function(e){if(!this._dynamicSize)return;var t=this._byteOffset+this.position+e,n=this._buffer.byteLength;if(t<=n){t>this._byteLength&&(this._byteLength=t);return}n<1&&(n=1);while(t>n)n*=2;var r=new ArrayBuffer(n),i=new Uint8Array(this._buffer),s=new Uint8Array(r,0,i.length);s.set(i),this.buffer=r,this._byteLength=t},DataStream.prototype._trimAlloc=function(){if(this._byteLength==this._buffer.byteLength)return;var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),n=new Uint8Array(this._buffer,0,t.length);t.set(n),this.buffer=e},DataStream.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},DataStream.prototype.isEof=function(){return this.position>=this._byteLength},DataStream.prototype.mapInt32Array=function(e,t){this._realloc(e*4);var n=new Int32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*4,n},DataStream.prototype.mapInt16Array=function(e,t){this._realloc(e*2);var n=new Int16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*2,n},DataStream.prototype.mapInt8Array=function(e){this._realloc(e*1);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=e*1,t},DataStream.prototype.mapUint32Array=function(e,t){this._realloc(e*4);var n=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*4,n},DataStream.prototype.mapUint16Array=function(e,t){this._realloc(e*2);var n=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*2,n},DataStream.prototype.mapUint8Array=function(e){this._realloc(e*1);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=e*1,t},DataStream.prototype.mapFloat64Array=function(e,t){this._realloc(e*8);var n=new Float64Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*8,n},DataStream.prototype.mapFloat32Array=function(e,t){this._realloc(e*4);var n=new Float32Array(this._buffer,this.byteOffset+this.position,e);return DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=e*4,n},DataStream.prototype.readInt32Array=function(e,t){e=e==null?this.byteLength-this.position/4:e;var n=new Int32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readInt16Array=function(e,t){e=e==null?this.byteLength-this.position/2:e;var n=new Int16Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readInt8Array=function(e){e=e==null?this.byteLength-this.position:e;var t=new Int8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readUint32Array=function(e,t){e=e==null?this.byteLength-this.position/4:e;var n=new Uint32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readUint16Array=function(e,t){e=e==null?this.byteLength-this.position/2:e;var n=new Uint16Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readUint8Array=function(e){e=e==null?this.byteLength-this.position:e;var t=new Uint8Array(e);return DataStream.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},DataStream.prototype.readFloat64Array=function(e,t){e=e==null?this.byteLength-this.position/8:e;var n=new Float64Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.readFloat32Array=function(e,t){e=e==null?this.byteLength-this.position/4:e;var n=new Float32Array(e);return DataStream.memcpy(n.buffer,0,this.buffer,this.byteOffset+this.position,e*n.BYTES_PER_ELEMENT),DataStream.arrayToNative(n,t==null?this.endianness:t),this.position+=n.byteLength,n},DataStream.prototype.writeInt32Array=function(e,t){this._realloc(e.length*4);if(e instanceof Int32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt32(e[n],t)},DataStream.prototype.writeInt16Array=function(e,t){this._realloc(e.length*2);if(e instanceof Int16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeInt16(e[n],t)},DataStream.prototype.writeInt8Array=function(e){this._realloc(e.length*1);if(e instanceof Int8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},DataStream.prototype.writeUint32Array=function(e,t){this._realloc(e.length*4);if(e instanceof Uint32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint32(e[n],t)},DataStream.prototype.writeUint16Array=function(e,t){this._realloc(e.length*2);if(e instanceof Uint16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint16Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeUint16(e[n],t)},DataStream.prototype.writeUint8Array=function(e){this._realloc(e.length*1);if(e instanceof Uint8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},DataStream.prototype.writeFloat64Array=function(e,t){this._realloc(e.length*8);if(e instanceof Float64Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat64Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat64(e[n],t)},DataStream.prototype.writeFloat32Array=function(e,t){this._realloc(e.length*4);if(e instanceof Float32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT==0)DataStream.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat32Array(e.length,t);else for(var n=0;n<e.length;n++)this.writeFloat32(e[n],t)},DataStream.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,e==null?this.endianness:e);return this.position+=4,t},DataStream.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,e==null?this.endianness:e);return this.position+=2,t},DataStream.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},DataStream.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,e==null?this.endianness:e);return this.position+=4,t},DataStream.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,e==null?this.endianness:e);return this.position+=2,t},DataStream.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},DataStream.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,e==null?this.endianness:e);return this.position+=4,t},DataStream.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,e==null?this.endianness:e);return this.position+=8,t},DataStream.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,t==null?this.endianness:t),this.position+=4},DataStream.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,t==null?this.endianness:t),this.position+=2},DataStream.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},DataStream.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,t==null?this.endianness:t),this.position+=4},DataStream.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,t==null?this.endianness:t),this.position+=2},DataStream.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},DataStream.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,t==null?this.endianness:t),this.position+=4},DataStream.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,t==null?this.endianness:t),this.position+=8},DataStream.endianness=(new Int8Array((new Int16Array([1])).buffer))[0]>0,DataStream.memcpy=function(e,t,n,r,i){var s=new Uint8Array(e,t,i),o=new Uint8Array(n,r,i);s.set(o)},DataStream.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},DataStream.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},DataStream.flipArrayEndianness=function(e){var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(var n=0;n<e.byteLength;n+=e.BYTES_PER_ELEMENT)for(var r=n+e.BYTES_PER_ELEMENT-1,i=n;r>i;r--,i++){var s=t[i];t[i]=t[r],t[r]=s}return e},DataStream.prototype.failurePosition=0,DataStream.prototype.readStruct=function(e){var t={},n,r,i,s=this.position;for(var o=0;o<e.length;o+=2){n=e[o+1],r=this.readType(n,t);if(r==null)return this.failurePosition==0&&(this.failurePosition=this.position),this.position=s,null;t[e[o]]=r}return t},DataStream.prototype.readUCS2String=function(e,t){return String.fromCharCode.apply(null,this.readUint16Array(e,t))},DataStream.prototype.writeUCS2String=function(e,t,n){n==null&&(n=e.length);for(var r=0;r<e.length&&r<n;r++)this.writeUint16(e.charCodeAt(r),t);for(;r<n;r++)this.writeUint16(0)},DataStream.prototype.readString=function(e,t){return t==null||t=="ASCII"?String.fromCharCode.apply(null,this.mapUint8Array(e==null?this.byteLength-this.position:e)):(new TextDecoder(t)).decode(this.mapUint8Array(e))},DataStream.prototype.writeString=function(e,t,n){if(t==null||t=="ASCII")if(n!=null){var r=0,i=Math.min(e.length,n);for(r=0;r<i;r++)this.writeUint8(e.charCodeAt(r));for(;r<n;r++)this.writeUint8(0)}else{for(var r=0;r<e.length;r++)this.writeUint8(e.charCodeAt(r));this.writeUint8(0)}else this.writeUint8Array((new TextEncoder(t)).encode(e.substring(0,n)))},DataStream.prototype.readCString=function(e){var t=this.byteLength-this.position,n=new Uint8Array(this._buffer,this._byteOffset+this.position),r=t;e!=null&&(r=Math.min(e,t));for(var i=0;i<r&&n[i]!=0;i++);var s=String.fromCharCode.apply(null,this.mapUint8Array(i));return e!=null?this.position+=r-i:i!=t&&(this.position+=1),s},DataStream.prototype.writeCString=function(e,t){if(t!=null){var n=0,r=Math.min(e.length,t);for(n=0;n<r;n++)this.writeUint8(e.charCodeAt(n));for(;n<t;n++)this.writeUint8(0)}else{for(var n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));this.writeUint8(0)}},DataStream.prototype.readType=function(e,t){if(typeof e=="function")return e(this,t);if(typeof e!="object"||e instanceof Array){if(e instanceof Array&&e.length!=3)return this.readStruct(e,t);var n=null,r=null,i="ASCII",s=this.position;if(typeof e=="string"&&/:/.test(e)){var o=e.split(":");e=o[0],r=parseInt(o[1])}if(typeof e=="string"&&/,/.test(e)){var o=e.split(",");e=o[0],i=parseInt(o[1])}switch(e){case"uint8":n=this.readUint8();break;case"int8":n=this.readInt8();break;case"uint16":n=this.readUint16(this.endianness);break;case"int16":n=this.readInt16(this.endianness);break;case"uint32":n=this.readUint32(this.endianness);break;case"int32":n=this.readInt32(this.endianness);break;case"float32":n=this.readFloat32(this.endianness);break;case"float64":n=this.readFloat64(this.endianness);break;case"uint16be":n=this.readUint16(DataStream.BIG_ENDIAN);break;case"int16be":n=this.readInt16(DataStream.BIG_ENDIAN);break;case"uint32be":n=this.readUint32(DataStream.BIG_ENDIAN);break;case"int32be":n=this.readInt32(DataStream.BIG_ENDIAN);break;case"float32be":n=this.readFloat32(DataStream.BIG_ENDIAN);break;case"float64be":n=this.readFloat64(DataStream.BIG_ENDIAN);break;case"uint16le":n=this.readUint16(DataStream.LITTLE_ENDIAN);break;case"int16le":n=this.readInt16(DataStream.LITTLE_ENDIAN);break;case"uint32le":n=this.readUint32(DataStream.LITTLE_ENDIAN);break;case"int32le":n=this.readInt32(DataStream.LITTLE_ENDIAN);break;case"float32le":n=this.readFloat32(DataStream.LITTLE_ENDIAN);break;case"float64le":n=this.readFloat64(DataStream.LITTLE_ENDIAN);break;case"cstring":n=this.readCString(r);break;case"string":n=this.readString(r,i);break;case"u16string":n=this.readUCS2String(r,this.endianness);break;case"u16stringle":n=this.readUCS2String(r,DataStream.LITTLE_ENDIAN);break;case"u16stringbe":n=this.readUCS2String(r,DataStream.BIG_ENDIAN);break;default:if(e.length==3){var u=e[1],a=e[2],f=0;typeof a=="function"?f=a(t,this,e):typeof a=="string"&&t[a]!=null?f=parseInt(t[a]):f=parseInt(a);if(typeof u=="string"){var l=u.replace(/(le|be)$/,""),c=null;/le$/.test(u)?c=DataStream.LITTLE_ENDIAN:/be$/.test(u)&&(c=DataStream.BIG_ENDIAN),a=="*"&&(f=null);switch(l){case"uint8":n=this.readUint8Array(f);break;case"uint16":n=this.readUint16Array(f,c);break;case"uint32":n=this.readUint32Array(f,c);break;case"int8":n=this.readInt8Array(f);break;case"int16":n=this.readInt16Array(f,c);break;case"int32":n=this.readInt32Array(f,c);break;case"float32":n=this.readFloat32Array(f,c);break;case"float64":n=this.readFloat64Array(f,c);break;case"cstring":case"utf16string":case"string":if(f==null){n=[];while(!this.isEof()){var h=this.readType(u,t);if(h==null)break;n.push(h)}}else{n=new Array(f);for(var p=0;p<f;p++)n[p]=this.readType(u,t)}}}else if(a=="*"){n=[],this.buffer;for(;;){var d=this.position;try{var v=this.readType(u,t);if(v==null){this.position=d;break}n.push(v)}catch(m){this.position=d;break}}}else{n=new Array(f);for(var p=0;p<f;p++){var h=this.readType(u,t);if(h==null)return null;n[p]=h}}break}}return r!=null&&(this.position=s+r),n}return e.get(this,t)},DataStream.prototype.writeStruct=function(e,t){for(var n=0;n<e.length;n+=2){var r=e[n+1];this.writeType(r,t[e[n]],t)}},DataStream.prototype.writeType=function(e,t,n){if(typeof e=="function")return e(this,t);if(!(typeof e!="object"||e instanceof Array))return e.set(this,t,n);var r=null,i="ASCII",s=this.position;if(typeof e=="string"&&/:/.test(e)){var o=e.split(":");e=o[0],r=parseInt(o[1])}if(typeof e=="string"&&/,/.test(e)){var o=e.split(",");e=o[0],i=parseInt(o[1])}switch(e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,DataStream.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,DataStream.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,DataStream.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,DataStream.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,DataStream.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,DataStream.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,DataStream.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,DataStream.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,DataStream.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,DataStream.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,DataStream.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,DataStream.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,r);break;case"string":this.writeString(t,i,r);break;case"u16string":this.writeUCS2String(t,this.endianness,r);break;case"u16stringle":this.writeUCS2String(t,DataStream.LITTLE_ENDIAN,r);break;case"u16stringbe":this.writeUCS2String(t,DataStream.BIG_ENDIAN,r);break;default:if(e.length==3){var u=e[1];for(var a=0;a<t.length;a++)this.writeType(u,t[a]);break}this.writeStruct(e,t)}r!=null&&(this.position=s,this._realloc(r),this.position=s+r)};var psdJs=function(){function t(e){try{this.ds=new DataStream(e,0,!1),this.header=new psdJsHeader(this),this.colorModeData=new psdJsColorModeData(this),this.imageResources=new psdJsImageResources(this),this.layerMask=new psdLayerMask(this)}catch(t){}}return t.prototype={seekToHeader:function(){},seekToColorModeData:function(){},seekToImageResources:function(){},seekToLayerMaskInfo:function(){},seekToImageData:function(){}},t}();psdLayerMask=function(e){this.len=e.ds.readUint32(),this.info=new psdLayerMaskInfo(e)},psdLayerMask.prototype={},psdLayerMaskInfo=function(e){this.len=Util.pad2(e.ds.readUint32()),this.layerCount=e.ds.readUint16(),this.layerRecords=this.parseLayerRecords(e),this.channelImageData=this.parseChannelImageData(e)},psdLayerMaskInfo.prototype={parseLayerRecords:function(e){var t=[],n;for(var r=0;r<this.layerCount;r++)n=new psdLayerRecord(e),t.push(n);return t},parseChannelImageData:function(e){var t=[],n;for(var r=0;r<this.layerCount;r++)n=new psdchannelImageData(e,r,this.layerRecords),t.push(n);return t}},psdLayerRecord=function(e){this.top=e.ds.readUint32(),this.left=e.ds.readUint32(),this.bottom=e.ds.readUint32(),this.right=e.ds.readUint32(),this.channels=e.ds.readUint16(),this.channelsInfo=[];if(this.channels>0)for(var t=0;t<this.channels;t++)this.channelsInfo[t]={},this.channelsInfo[t].id=e.ds.readUint16(),this.channelsInfo[t].len=e.ds.readUint32(),this.channelsInfo[t].rgbakey=this.getRGBAType(this.channelsInfo[t].id);this.blendModeSignature=e.ds.readString(4),this.blendModeKey=e.ds.readString(4),this.blendModeName=this.getBlendModeName(),this.opacity=e.ds.readUint8(),this.clipping=e.ds.readUint8(),this.flags=e.ds.readUint8(),this.filler=e.ds.readUint8(),this.lenDataBlendingName=e.ds.readUint32(),this.startLen=e.ds.position,this.layerMask=new psdLayerMaskAdjustmentData(e),this.layerBlendingRanges=new psdLayerBlendingRangesData(e),this.namelen=Util.pad2(e.ds.readUint8()),this.namelen==0?console.log("This is running"):(this.layername=e.ds.readString(this.namelen),e.ds.position=this.startLen+this.lenDataBlendingName)},psdLayerRecord.prototype={getRGBAType:function(e){return e==65535?"A":"RGB".substring(e,e+1)},getBlendModeName:function(){var e=this.blendModeKey,t={pass:"pass through",norm:"normal",diss:"dissolve",dark:"darken","mul ":"multiply",idiv:"color burn",lbrn:"linear burn",dkCl:"darker color",lite:"lighten",scrn:"screen","div ":"color dodge",lddg:"linear dodge",lgCl:"lighter color",over:"overlay",sLit:"soft light",hLit:"hard light",vLit:"vivid light",lLit:"linear light",pLit:"pin light",hMix:"hard mix",diff:"difference",smud:"exclusion",fsub:"subtract",fdiv:"divide","hue ":"hue","sat ":"saturation",colr:"color","lum ":"luminosity"};return t[e]}},psdLayerMaskAdjustmentData=function(e){this.size=e.ds.readUint32();if(this.size==0)return;console.log("The SIZE IS NOT 0")},psdLayerBlendingRangesData=function(e){this.size=e.ds.readUint32(),e.ds.position=e.ds.position+this.size},psdImageData=function(e){e.ds.seek(e.ds.position+e.layerMask.len-4),this.compression=e.ds.readUint16(),this.data=e.ds.readUint8Array(e.ds._byteLength-e.ds.position)},psdchannelImageData=function(e,t,n){this.compression=e.ds.readUint16(),e.ds.position=e.ds.position+this.dataSize;if(this.compression==0){this.dataSize=(n[t].bottom-n[t].top)*(n[t].right-n[t].left);if(this.dataSize==0)return;if(this.dataSize==2e6){var r=this.dataSize*Uint8Array.BYTES_PER_ELEMENT,i=new ArrayBuffer(r);this.data=new Uint8Array(i);for(var s=0;s<this.data.length;s++)this.data[s]=e.ds.readUint8();var o=document.createElement("canvas");o.height=n[t].bottom-n[t].top,o.width=n[t].right-n[t].left;var u=o.getContext("2d"),a=u.getImageData(0,0,o.width,o.height);console.log(this.data.length);var f=this.data.length;for(var s=0;s<f;s++)a.data[s]=this.data[s];console.log(a),u.putImageData(a,0,0);var l=document.getElementById("img");l.height=o.height,l.width=o.width,l.src=o.toDataURL(),console.log(u),console.log(l)}else e.ds.position=e.ds.position+this.dataSize}else this.compression==1?(e.ds.position=e.ds.position+this.dataSize,console.log(e.ds.readUint8())):(e.ds.position=e.ds.position+this.dataSize,console.log("Different compression"))};var psdJsHeader=function(){"use strict";function t(e){this.start=e.ds.position;var t=["signature","string:4","version","uint16","reserved","string:6","channels","uint16","height","uint32","width","uint32","depth","uint16","colormode","uint16"];Util.extend(this,e.ds.readStruct(t));if(this.signature!="8BPS"||this.version!=1)throw new Error("Invalid PSD");this.colormodeName=this.getColorMode()}return t.prototype={getColorMode:function(){var e={0:"Bitmap",1:"Grayscale",2:"Indexed",3:"RGB",4:"CMYK",7:"Multichannel",8:"Duotone",9:"Lab"};return e[this.colormode]}},t}(),psdJsColorModeData=function(){"use strict";function t(e){this.size=e.ds.readUint32(),e.header.colorMode!="Indexed"&&e.header.colorMode!="Duotone"&&this.size!=0&&(this.data=e.ds.readUint32())}return t}(),psdJsImageResources=function(){"use strict";function t(e){var t;this.resources=[],this.size=t=e.ds.readUint32();var n=0;while(t>0){var r=this.processResourceBlock(e);t-=r}t<0&&console.log("Image Resources failed (psdImageResources) Over: "+t)}return t.prototype={processResourceBlock:function(e){var t=new psdJsImageResourceBlock(e);return this.resources.push(t),t.totalSize}},t}(),psdJsImageResourceBlock=function(){"use strict";function t(e){var t=e.ds.position,n,r=0;this.totalSize=0,this.len=0,this.signature=e.ds.readString(4),this.id=e.ds.readUint16(),this.namelen=Util.pad2(e.ds.readUint8()),this.namelen==0?this.name=e.ds.readUint8():console.log("Image Resource block failed namelen: "+this.namelen),this.len=Util.pad2(e.ds.readUint32()),this.totalSize=e.ds.position+this.len-t;var i=this.len*Uint8Array.BYTES_PER_ELEMENT,s=new ArrayBuffer(i);this.data=new Uint8Array(s);for(var o=this.data.length-1;o>=0;o--)this.data[o]=e.ds.readUint8()}return t}();"use strict";var Util=psdJs.Util=function(){function t(){}return t.extend=function(e,t){for(var n in t)e[n]=t[n];return e},t.pad2=function(e){return e%2==0?e:e+1},t.pad4=function(e){},t.rleEnconde=function(e){},t.rleDecode=function(e){var t="";return e.forEach(function(e){t+=(new Array(1+e[0])).join(e[1])}),t},t}();